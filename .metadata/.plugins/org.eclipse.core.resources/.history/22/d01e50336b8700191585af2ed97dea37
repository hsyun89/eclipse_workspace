<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>크리스마스 카드</title>
<style>
.button {
	padding: 5px 10px;
	margin: auto;
	display: inline;
	background: #777 repeat-x bottom;
	border: none;
	color: #fff;
	cursor: pointer;
	font-weight: bold;
	border-radius: 5px;
	text-shadow: 1px 1px #666;
	display: inline;
}

.button:active {
	background-position: 0 top;
	position: relative;
	top: 1px;
	padding: 6px 10px 4px;
}

#dropbox {
	float: left;
	width: 500px;
	height: 300px;
	margin: 10px;
	border: 1px solid #999999;
}

#picturesbox {
	float: left;
	width: 320px;
	margin: 10px;
	border: 1px solid #999999;
}

#picturesbox>img {
	float: left;
	padding: 5px;
}
</style>
<script>
	
</script>
</head>
<body>
	<h1>HTML5로 크리스마스 카드 만들기</h1>
	<span class="button" onclick="saveItem()">저장하기</span>
	<span class="button" onclick="removeItem()">삭제하기</span>
	<span class="button" onclick="readItem()">읽어오기</span>
	<br>
	<section id="dropbox">
		<canvas id="canvas" width="500" height="300"></canvas>
	</section>
	<section id="picturesbox">
		<img id="image1" src="/edu/jsexam/bonobono/bn1.png" width="100">
		<img id="image2" src="/edu/jsexam/bonobono/bn2.png" width="100">
		<img id="image3" src="/edu/jsexam/bonobono/bn3.png"> <img
			id="image4" src="/edu/jsexam/bonobono/bn4.png"> <img
			id="image5" src="/edu/jsexam/bonobono/bn5.png"> <img
			id="image6" src="/edu/jsexam/bonobono/bn6.png"> <img
			id="image7" src="/edu/jsexam/bonobono/bn7.png"> <img
			id="image8" src="/edu/jsexam/bonobono/bn8.png"> <img
			id="image9" src="/edu/jsexam/bonobono/bn9.png"> <img
			id="image10" src="/edu/jsexam/bonobono/bn10.png"> <img
			id="image11" src="/edu/jsexam/bonobono/bn11.png"> <img
			id="image12" src="/edu/jsexam/bonobono/bn12.png"> <img
			id="image13" src="/edu/jsexam/bonobono/bn13.png"> <img
			id="image14" src="/edu/jsexam/bonobono/bn14.png">

	</section>

	<script>
		var canvas, drop;
		function initiate() {
			var images = document.querySelectorAll('#picturesbox > img');
			for (var i = 0; i < images.length; i++) {
				images[i].addEventListener('dragstart', dragged, false);
				images[i].addEventListener('dragend', ending, false);
			}

			drop = document.getElementById('canvas');
			canvas = drop.getContext('2d');

			drop.addEventListener('dragover', function(e) {
				e.preventDefault();
			}, false);
			drop.addEventListener('drop', dropped, false);
		}
		function ending(e) {
			elem = e.target;
			//elem.style.visibility='hidden';
			//elem.style.display='none';
			//elem.parentNode.removeChild(elem);
		}
		function dragged(e) {
			var elem = e.target;
			e.dataTransfer.setData('aa', elem.getAttribute('id'));
			e.dataTransfer.setDragImage(e.target, 0, 0);
		}
		function dropped(e) {
			e.preventDefault();
			var id = e.dataTransfer.getData('aa');
			var elem = document.getElementById(id);

			var posx = e.pageX - drop.offsetLeft;
			var posy = e.pageY - drop.offsetTop;

			canvas.drawImage(elem, posx, posy);

		}
		window.addEventListener('load', initiate, false);

		function saveItem() {
			alert(drop.toDataURL());
			localStorage.setItem("canvas", drop.toDataURL());
		}
		function removeItem() {
			canvas.clearRect(0, 0, 600, 300);
		}
		function readItem() {
			var img = new Image();
			img.src = localStorage.getItem("canvas");
			img.onload = function() { //이미지를 완전히 받았을 때 실행(동기처리)
				canvas.drawImage(img, 0, 0);
			}
		}
	</script>
</body>
</html>

